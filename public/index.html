<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PB Tools</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='7' fill='%236366f1'/%3E%3Ctext x='16' y='22' font-family='system-ui,-apple-system,sans-serif' font-size='15' font-weight='700' fill='white' text-anchor='middle' letter-spacing='-0.5'%3Epb%3C/text%3E%3C/svg%3E" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AUTH SCREEN (shown when no token)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="auth-screen" class="auth-shell">
  <div class="auth-card">
    <div class="auth-logo">PB Tools</div>
    <div class="auth-tagline">Productboard import &amp; export toolkit</div>

    <div class="field">
      <label for="auth-token">Productboard API token</label>
      <div class="input-row">
        <input type="password" id="auth-token" placeholder="paste your token here" autocomplete="off" />
      </div>
    </div>

    <div class="field mt-8">
      <label class="checkbox-row">
        <input type="checkbox" id="auth-eu" />
        Use EU datacenter
      </label>
    </div>

    <button class="btn btn-primary btn-full mt-16" id="auth-submit">Connect</button>

    <div id="auth-error" class="alert alert-danger hidden mt-12">
      <span class="alert-icon">‚ö†Ô∏è</span>
      <span id="auth-error-msg"></span>
    </div>

    <p class="text-sm text-muted mt-16">
      Your token is never stored on our servers ‚Äî it lives only in this browser session and is passed directly to Productboard on each request.
    </p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     APP SHELL (shown when token is present)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app-screen" class="app-shell hidden">

  <!-- Top bar -->
  <header class="topbar">
    <button class="topbar-logo" id="btn-home">PB Tools</button>
    <span id="topbar-breadcrumb" class="topbar-breadcrumb hidden">
      <span class="topbar-dot">¬∑</span>
      <span id="topbar-tool-name" class="topbar-tool-name"></span>
    </span>
    <div class="topbar-right">
      <div class="dc-toggle">
        <button class="dc-btn" id="dc-us">US</button>
        <button class="dc-btn" id="dc-eu">EU</button>
      </div>
      <button class="btn btn-ghost btn-sm" id="btn-disconnect">Disconnect</button>
    </div>
  </header>

  <!-- ‚îÄ‚îÄ HOME VIEW ‚îÄ‚îÄ -->
  <div id="home-view" class="home-shell hidden">
    <div class="home-content">
      <h1 class="home-title">PB Tools</h1>
      <p class="home-subtitle">Select a tool to get started.</p>
      <div class="tool-grid">

        <div class="tool-card" data-tool="companies">
          <div class="tool-card-icon">üè¢</div>
          <div class="tool-card-name">Companies</div>
          <div class="tool-card-desc">Export and import companies, including custom fields and UUID-based patching.</div>
        </div>

        <div class="tool-card" data-tool="notes">
          <div class="tool-card-icon">üìù</div>
          <div class="tool-card-name">Notes</div>
          <div class="tool-card-desc">Export, import, delete, and migrate notes across workspaces.</div>
        </div>

        <div class="tool-card tool-card-soon">
          <div class="tool-card-icon">üì¶</div>
          <div class="tool-card-name">Entities <span class="badge badge-muted">Soon</span></div>
          <div class="tool-card-desc">Import and delete features, stories, and more.</div>
        </div>

        <div class="tool-card tool-card-soon">
          <div class="tool-card-icon">üë•</div>
          <div class="tool-card-name">Teams membership <span class="badge badge-muted">Soon</span></div>
          <div class="tool-card-desc">Bulk-manage team assignments across entities.</div>
        </div>

      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ TOOL VIEW ‚îÄ‚îÄ -->
  <div id="tool-view" class="hidden">
    <div class="main-content">

      <!-- Left nav -->
      <nav class="sidebar-nav">
        <span class="nav-section-label">Tools</span>

        <!-- Companies nav items -->
        <div id="sidebar-companies">
          <button class="nav-item active" data-view="export" id="nav-export">
            <span class="icon">üì§</span> Export companies
          </button>
          <button class="nav-item" data-view="import" id="nav-import">
            <span class="icon">üì•</span> Import companies
          </button>
          <button class="nav-item" data-view="companies-delete-csv" id="nav-companies-delete-csv">
            <span class="icon">üóë</span> Delete from CSV
          </button>
          <button class="nav-item" data-view="companies-delete-all" id="nav-companies-delete-all">
            <span class="icon">‚ö†Ô∏è</span> Delete all companies
          </button>
        </div>

        <!-- Notes nav items -->
        <div id="sidebar-notes" class="hidden">
          <button class="nav-item" data-view="notes-export" id="nav-notes-export">
            <span class="icon">üì§</span> Export notes
          </button>
          <button class="nav-item" data-view="notes-import" id="nav-notes-import">
            <span class="icon">üì•</span> Import notes
          </button>
          <button class="nav-item" data-view="notes-delete-csv" id="nav-notes-delete-csv">
            <span class="icon">üóë</span> Delete from CSV
          </button>
          <button class="nav-item" data-view="notes-delete-all" id="nav-notes-delete-all">
            <span class="icon">‚ö†Ô∏è</span> Delete all notes
          </button>
          <button class="nav-item" data-view="notes-migrate" id="nav-notes-migrate">
            <span class="icon">üîÑ</span> Migration prep
          </button>
        </div>

      </nav>

      <!-- Right panel area -->
      <div id="view-area">

        <!-- ‚îÄ‚îÄ EXPORT VIEW ‚îÄ‚îÄ -->
        <div id="view-export">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Export companies</div>
              <div class="panel-subtitle">Download all Productboard companies as a CSV file, including custom fields.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div id="export-idle">
                <p class="text-sm text-muted">
                  This will fetch all companies from your Productboard workspace and generate a CSV you can download and edit.
                </p>
                <button class="btn btn-primary mt-16" id="btn-export">Export companies</button>
              </div>

              <div id="export-running" class="hidden">
                <div class="progress-wrap">
                  <div class="progress-bar" id="export-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="export-progress-msg">Starting‚Ä¶</span>
                  <span id="export-progress-pct">0%</span>
                </div>
              </div>

              <div id="export-done" class="hidden">
                <div class="alert alert-ok">
                  <span class="alert-icon">‚úÖ</span>
                  <span id="export-done-msg"></span>
                </div>
                <button class="btn btn-primary mt-16" id="btn-download-csv">‚¨áÔ∏è Download CSV</button>
                <button class="btn btn-secondary mt-8" id="btn-export-again">Export again</button>
              </div>

              <div id="export-error" class="hidden">
                <div class="alert alert-danger">
                  <span class="alert-icon">‚ö†Ô∏è</span>
                  <span id="export-error-msg"></span>
                </div>
                <button class="btn btn-secondary mt-12" id="btn-export-retry">Try again</button>
              </div>

            </div>
          </div>
        </div><!-- /view-export -->

        <!-- ‚îÄ‚îÄ IMPORT VIEW ‚îÄ‚îÄ -->
        <div id="view-import" class="hidden">

          <!-- Step 1: Upload CSV -->
          <div class="panel" id="import-step-upload">
            <div class="panel-header">
              <div class="panel-title">Import companies</div>
              <div class="panel-subtitle">Upload a CSV, map columns to Productboard fields, then run the import.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div class="dropzone" id="dropzone">
                <span class="dropzone-icon">üìÑ</span>
                <div class="dropzone-label">Drop a CSV file here</div>
                <div class="dropzone-hint">or click to browse</div>
              </div>
              <input type="file" id="file-input" accept=".csv,text/csv" class="hidden" />
            </div>
          </div>

          <!-- Step 2: Map fields -->
          <div class="panel mt-16 hidden" id="import-step-map">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div>
                  <div class="panel-title">Map columns</div>
                  <div class="panel-subtitle" id="map-subtitle"></div>
                </div>
                <button class="btn btn-ghost btn-sm" id="btn-reupload">‚Ü© Re-upload</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <!-- Base field mapping -->
              <div class="mb-16">
                <label>Base fields</label>
                <div class="text-sm text-muted mb-16">Map your CSV columns to Productboard company fields.</div>
                <table class="mapping-table">
                  <thead>
                    <tr>
                      <th>PB Field</th>
                      <th>CSV Column</th>
                      <th>Required</th>
                    </tr>
                  </thead>
                  <tbody id="base-field-map-rows"></tbody>
                </table>
              </div>

              <!-- Custom field mapping -->
              <div id="custom-fields-section">
                <label>Custom fields <span class="label-hint">‚Äî map CSV columns to custom fields</span></label>
                <div id="custom-fields-loading" class="text-sm text-muted mt-8">Loading custom fields‚Ä¶</div>
                <table class="mapping-table mt-8 hidden" id="custom-field-table">
                  <thead>
                    <tr>
                      <th>PB Custom Field</th>
                      <th>Type</th>
                      <th>CSV Column</th>
                    </tr>
                  </thead>
                  <tbody id="custom-field-map-rows"></tbody>
                </table>
              </div>

              <div id="unmapped-warning" class="alert alert-warn hidden mt-12">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span id="unmapped-warning-msg"></span>
              </div>

              <!-- Options -->
              <div class="mt-16">
                <label class="checkbox-row" id="clear-empty-label">
                  <input type="checkbox" id="clear-empty-fields" />
                  Clear empty custom field values in Productboard (delete value if CSV cell is empty)
                </label>
              </div>

              <div class="flex gap-8 mt-16">
                <button class="btn btn-secondary" id="btn-validate">‚úÖ Validate first</button>
                <button class="btn btn-primary" id="btn-run-import">üì• Import</button>
              </div>

            </div>
          </div>

          <!-- Step 3: Validation results -->
          <div class="panel mt-16 hidden" id="import-step-validate">
            <div class="panel-header">
              <div class="panel-title">Validation results</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div id="validate-ok" class="hidden">
                <div class="alert alert-ok">
                  <span class="alert-icon">‚úÖ</span>
                  <span id="validate-ok-msg"></span>
                </div>
                <div class="flex gap-8 mt-16">
                  <button class="btn btn-primary" id="btn-run-after-validate">üì• Run import</button>
                  <button class="btn btn-secondary" id="btn-back-to-map">‚Üê Back to mapping</button>
                </div>
              </div>
              <div id="validate-errors" class="hidden">
                <div class="alert alert-danger">
                  <span class="alert-icon">‚ö†Ô∏è</span>
                  <span id="validate-error-summary"></span>
                </div>
                <div class="result-scroll mt-12">
                  <table class="results-table">
                    <thead><tr><th>Row</th><th>Column</th><th>Error</th></tr></thead>
                    <tbody id="validate-error-rows"></tbody>
                  </table>
                </div>
                <button class="btn btn-secondary mt-12" id="btn-back-to-map2">‚Üê Fix &amp; re-map</button>
              </div>
            </div>
          </div>

          <!-- Step 4: Import progress + results -->
          <div class="panel mt-16 hidden" id="import-step-run">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div class="panel-title" id="import-run-title">Importing‚Ä¶</div>
                <button class="btn btn-danger btn-sm hidden" id="btn-stop-import">‚èπ Stop import</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div id="import-running">
                <div class="progress-wrap">
                  <div class="progress-bar" id="import-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="import-progress-msg">Starting‚Ä¶</span>
                  <span id="import-progress-pct">0%</span>
                </div>
              </div>

              <!-- Live log (appears once first log entry arrives, persists after stop/complete) -->
              <div id="import-live-log" class="live-log hidden mt-16">
                <div class="live-log-header">
                  <span>Live log</span>
                  <span id="live-log-counts" class="live-log-counts"></span>
                </div>
                <div id="live-log-entries" class="live-log-scroll"></div>
              </div>

              <div id="import-results" class="hidden">
                <div id="import-summary-alert"></div>
                <button class="btn btn-secondary mt-16" id="btn-import-again">‚Üê Import another file</button>
              </div>

            </div>
          </div>

        </div><!-- /view-import -->

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             COMPANIES DELETE VIEWS
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

        <!-- ‚îÄ‚îÄ COMPANIES DELETE FROM CSV ‚îÄ‚îÄ -->
        <div id="view-companies-delete-csv" class="hidden">

          <!-- Step 1: Upload -->
          <div class="panel" id="companies-delete-csv-step-upload">
            <div class="panel-header">
              <div class="panel-title">Delete companies from CSV</div>
              <div class="panel-subtitle">Upload a CSV containing company UUIDs and permanently delete those companies.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div class="alert alert-warn mb-16">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span>This action is <strong>irreversible</strong>. Deleted companies cannot be recovered. You can use the export CSV directly ‚Äî just select the <em>id</em> column.</span>
              </div>
              <div class="dropzone" id="companies-delete-dropzone">
                <span class="dropzone-icon">üìÑ</span>
                <div class="dropzone-label">Drop a CSV file here</div>
                <div class="dropzone-hint">or click to browse</div>
              </div>
              <input type="file" id="companies-delete-file-input" accept=".csv,text/csv" class="hidden" />
            </div>
          </div>

          <!-- Step 2: Column picker + confirm -->
          <div class="panel mt-16 hidden" id="companies-delete-csv-step-confirm">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div>
                  <div class="panel-title">Confirm deletion</div>
                  <div class="panel-subtitle" id="companies-delete-csv-subtitle"></div>
                </div>
                <button class="btn btn-ghost btn-sm" id="btn-companies-delete-reupload">‚Ü© Re-upload</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div class="mb-16">
                <label>Which column contains the company UUIDs?</label>
                <select id="companies-delete-uuid-column" class="mt-8" style="width:100%;max-width:320px;padding:6px 8px;border:1px solid var(--c-border);border-radius:6px;font-size:14px"></select>
              </div>
              <div id="companies-delete-csv-preview" class="mb-16 text-sm text-muted font-mono hidden"></div>
              <button class="btn btn-danger" id="btn-companies-delete-csv-run">üóë Delete companies</button>
            </div>
          </div>

          <!-- Step 3: Progress + log -->
          <div class="panel mt-16 hidden" id="companies-delete-csv-step-run">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div class="panel-title" id="companies-delete-csv-run-title">Deleting companies‚Ä¶</div>
                <button class="btn btn-danger btn-sm hidden" id="btn-stop-companies-delete-csv">‚èπ Stop</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div id="companies-delete-csv-running">
                <div class="progress-wrap">
                  <div class="progress-bar" id="companies-delete-csv-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="companies-delete-csv-progress-msg">Starting‚Ä¶</span>
                  <span id="companies-delete-csv-progress-pct">0%</span>
                </div>
                <div id="companies-delete-csv-live-log" class="live-log hidden mt-16">
                  <div class="live-log-header"><span>Live log</span></div>
                  <div id="companies-delete-csv-log-entries" class="live-log-scroll"></div>
                </div>
              </div>
              <div id="companies-delete-csv-results" class="hidden">
                <div id="companies-delete-csv-summary-alert"></div>
                <button class="btn btn-secondary mt-16" id="btn-companies-delete-csv-again">‚Üê Delete more</button>
              </div>
            </div>
          </div>

        </div><!-- /view-companies-delete-csv -->

        <!-- ‚îÄ‚îÄ COMPANIES DELETE ALL ‚îÄ‚îÄ -->
        <div id="view-companies-delete-all" class="hidden">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Delete all companies</div>
              <div class="panel-subtitle">Permanently delete every company in your Productboard workspace.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div id="companies-delete-all-idle">
                <div class="alert alert-danger mb-16">
                  <span class="alert-icon">‚õî</span>
                  <span><strong>This will permanently delete every company in your workspace.</strong> This action cannot be undone and there is no way to recover deleted companies. Use with extreme caution ‚Äî ideally export first.</span>
                </div>
                <p class="text-sm text-muted mb-16">Type <strong>DELETE</strong> in the box below to enable the button.</p>
                <input type="text" id="companies-delete-all-confirm-input" placeholder="Type DELETE to confirm" autocomplete="off"
                  style="display:block;width:100%;max-width:320px;padding:8px 10px;border:1px solid var(--c-border);border-radius:6px;font-size:14px;margin-bottom:12px" />
                <button class="btn btn-danger" id="btn-companies-delete-all-run" disabled>‚õî Delete all companies</button>
              </div>

              <div id="companies-delete-all-running" class="hidden">
                <div class="progress-wrap">
                  <div class="progress-bar" id="companies-delete-all-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="companies-delete-all-progress-msg">Starting‚Ä¶</span>
                  <span id="companies-delete-all-progress-pct">0%</span>
                </div>
                <div id="companies-delete-all-live-log" class="live-log hidden mt-16">
                  <div class="live-log-header"><span>Live log</span></div>
                  <div id="companies-delete-all-log-entries" class="live-log-scroll"></div>
                </div>
              </div>

              <div id="companies-delete-all-results" class="hidden">
                <div id="companies-delete-all-summary-alert"></div>
                <button class="btn btn-secondary mt-16" id="btn-companies-delete-all-again">‚Üê Start over</button>
              </div>

            </div>
          </div>
        </div><!-- /view-companies-delete-all -->

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             NOTES VIEWS
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

        <!-- ‚îÄ‚îÄ NOTES EXPORT ‚îÄ‚îÄ -->
        <div id="view-notes-export" class="hidden">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Export notes</div>
              <div class="panel-subtitle">Download all Productboard notes as a CSV file.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div id="notes-export-idle">
                <div class="alert alert-info mb-16">
                  <span class="alert-icon">‚ÑπÔ∏è</span>
                  <span>Fetches notes via the v2 API (relationships included inline), then enriches any missing source origin/record ID from the v1 API. Large workspaces may take a few minutes.</span>
                </div>
                <p class="text-sm text-muted">
                  <strong>Columns exported:</strong> PB Note ID, Type, Title, Content, Display URL, User Email, Company Domain, Owner Email, Creator Email, Tags, Source Origin, Source Record ID, Archived, Processed, Created At, Updated At, Linked Entities.
                </p>

                <div class="filter-block mt-16">
                  <p class="filter-block-label">Date filter <span class="label-hint">(optional)</span></p>
                  <div class="filter-radios">
                    <label class="radio-label"><input type="radio" name="notes-date-filter" value="none" checked> No filter ‚Äî export all notes</label>
                    <label class="radio-label"><input type="radio" name="notes-date-filter" value="range"> Date range</label>
                    <label class="radio-label"><input type="radio" name="notes-date-filter" value="dynamic"> Past N period</label>
                  </div>

                  <div id="notes-filter-range" class="filter-sub hidden mt-12">
                    <div class="input-row">
                      <div class="field mb-0">
                        <label for="notes-filter-from" class="text-sm">From <span class="label-hint">(leave blank for open start)</span></label>
                        <input type="date" id="notes-filter-from">
                      </div>
                      <div class="field mb-0">
                        <label for="notes-filter-to" class="text-sm">To <span class="label-hint">(leave blank for open end)</span></label>
                        <input type="date" id="notes-filter-to">
                      </div>
                    </div>
                  </div>

                  <div id="notes-filter-dynamic" class="filter-sub hidden mt-12">
                    <label class="text-sm">Export notes created in the past</label>
                    <div class="filter-dynamic-row mt-4">
                      <input type="number" id="notes-filter-n" min="1" value="7" style="width:72px">
                      <select id="notes-filter-period" style="width:auto">
                        <option value="days">days</option>
                        <option value="weeks">weeks</option>
                        <option value="months">months</option>
                      </select>
                    </div>
                  </div>
                </div>

                <button class="btn btn-primary mt-16" id="btn-notes-export">Export notes</button>
              </div>

              <div id="notes-export-running" class="hidden">
                <div class="progress-wrap">
                  <div class="progress-bar" id="notes-export-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="notes-export-progress-msg">Starting‚Ä¶</span>
                  <span id="notes-export-progress-pct">0%</span>
                </div>
              </div>

              <div id="notes-export-done" class="hidden">
                <div class="alert alert-ok">
                  <span class="alert-icon">‚úÖ</span>
                  <span id="notes-export-done-msg"></span>
                </div>
                <button class="btn btn-primary mt-16" id="btn-notes-download-csv">‚¨áÔ∏è Download CSV</button>
                <button class="btn btn-secondary mt-8" id="btn-notes-export-again">Export again</button>
              </div>

              <div id="notes-export-error" class="hidden">
                <div class="alert alert-danger">
                  <span class="alert-icon">‚ö†Ô∏è</span>
                  <span id="notes-export-error-msg"></span>
                </div>
                <button class="btn btn-secondary mt-12" id="btn-notes-export-retry">Try again</button>
              </div>

            </div>
          </div>
        </div><!-- /view-notes-export -->

        <!-- ‚îÄ‚îÄ NOTES IMPORT ‚îÄ‚îÄ -->
        <div id="view-notes-import" class="hidden">

          <!-- Step 1: Upload -->
          <div class="panel" id="notes-import-step-upload">
            <div class="panel-header">
              <div class="panel-title">Import notes</div>
              <div class="panel-subtitle">Upload a CSV, map columns to Productboard note fields, then run the import.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div class="alert alert-info mb-16">
                <span class="alert-icon">‚ÑπÔ∏è</span>
                <span>Notes are created via the v1 API (which supports linking by user email or company domain). Status fields (archived/processed) and creator/owner are applied via a v2 backfill step after creation.</span>
              </div>
              <div class="dropzone" id="notes-dropzone">
                <span class="dropzone-icon">üìÑ</span>
                <div class="dropzone-label">Drop a CSV file here</div>
                <div class="dropzone-hint">or click to browse</div>
              </div>
              <input type="file" id="notes-file-input" accept=".csv,text/csv" class="hidden" />
            </div>
          </div>

          <!-- Step 2: Map columns -->
          <div class="panel mt-16 hidden" id="notes-import-step-map">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div>
                  <div class="panel-title">Map columns</div>
                  <div class="panel-subtitle" id="notes-map-subtitle"></div>
                </div>
                <button class="btn btn-ghost btn-sm" id="btn-notes-reupload">‚Ü© Re-upload</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <table class="mapping-table">
                <thead>
                  <tr><th>PB Field</th><th>CSV Column</th><th>Required</th></tr>
                </thead>
                <tbody id="notes-field-map-rows"></tbody>
              </table>

              <!-- Migration mode -->
              <div class="mt-16">
                <label class="checkbox-row" id="notes-migration-mode-label">
                  <input type="checkbox" id="notes-migration-mode" />
                  Migration mode ‚Äî remap linked entity UUIDs via a custom text field
                </label>
                <div class="text-sm text-muted mt-4" style="padding-left:24px">
                  Enable this when importing notes exported from a different workspace. The tool looks up entities in the <em>target</em> workspace using a custom text field that stores the original UUID, then links to those entities instead.
                </div>
                <div class="hidden mt-8" id="notes-migration-field-row" style="padding-left:24px">
                  <div class="flex gap-8 align-center flex-wrap">
                    <label class="text-sm" for="notes-migration-field-name" style="white-space:nowrap">Custom field name:</label>
                    <input type="text" id="notes-migration-field-name" value="original_uuid" style="width:200px" />
                    <button class="btn btn-secondary btn-sm" id="btn-notes-detect-field">üîç Detect</button>
                    <span id="notes-migration-field-status" class="text-sm"></span>
                  </div>
                </div>
              </div>

              <div class="flex gap-8 mt-16">
                <button class="btn btn-secondary" id="btn-notes-validate">‚úÖ Validate first</button>
                <button class="btn btn-primary" id="btn-notes-run-import">üì• Import</button>
              </div>

            </div>
          </div>

          <!-- Step 3: Validation results -->
          <div class="panel mt-16 hidden" id="notes-import-step-validate">
            <div class="panel-header">
              <div class="panel-title">Validation results</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div id="notes-validate-ok" class="hidden">
                <div class="alert alert-ok">
                  <span class="alert-icon">‚úÖ</span>
                  <span id="notes-validate-ok-msg"></span>
                </div>
                <div id="notes-validate-warnings-section" class="hidden mt-12">
                  <div class="alert alert-warn">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span id="notes-validate-warnings-summary"></span>
                  </div>
                  <div class="result-scroll mt-8">
                    <table class="results-table">
                      <thead><tr><th>Row</th><th>Column</th><th>Warning</th></tr></thead>
                      <tbody id="notes-validate-warning-rows"></tbody>
                    </table>
                  </div>
                </div>
                <div class="flex gap-8 mt-16">
                  <button class="btn btn-primary" id="btn-notes-run-after-validate">üì• Run import</button>
                  <button class="btn btn-secondary" id="btn-notes-back-to-map">‚Üê Back to mapping</button>
                </div>
              </div>
              <div id="notes-validate-errors" class="hidden">
                <div class="alert alert-danger">
                  <span class="alert-icon">‚ö†Ô∏è</span>
                  <span id="notes-validate-error-summary"></span>
                </div>
                <div class="result-scroll mt-12">
                  <table class="results-table">
                    <thead><tr><th>Row</th><th>Column</th><th>Error</th></tr></thead>
                    <tbody id="notes-validate-error-rows"></tbody>
                  </table>
                </div>
                <button class="btn btn-secondary mt-12" id="btn-notes-back-to-map2">‚Üê Fix &amp; re-map</button>
              </div>
            </div>
          </div>

          <!-- Step 4: Run -->
          <div class="panel mt-16 hidden" id="notes-import-step-run">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div class="panel-title" id="notes-import-run-title">Importing notes‚Ä¶</div>
                <button class="btn btn-danger btn-sm hidden" id="btn-stop-notes-import">‚èπ Stop import</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div id="notes-import-running">
                <div class="progress-wrap">
                  <div class="progress-bar" id="notes-import-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="notes-import-progress-msg">Starting‚Ä¶</span>
                  <span id="notes-import-progress-pct">0%</span>
                </div>
                <div id="notes-import-live-log" class="live-log hidden mt-16">
                  <div class="live-log-header">
                    <span>Live log</span>
                    <span id="notes-live-log-counts" class="live-log-counts"></span>
                  </div>
                  <div id="notes-live-log-entries" class="live-log-scroll"></div>
                </div>
              </div>

              <div id="notes-import-results" class="hidden">
                <div id="notes-import-summary-alert"></div>
                <button class="btn btn-secondary mt-16" id="btn-notes-import-again">‚Üê Import another file</button>
              </div>

            </div>
          </div>

        </div><!-- /view-notes-import -->

        <!-- ‚îÄ‚îÄ NOTES DELETE FROM CSV ‚îÄ‚îÄ -->
        <div id="view-notes-delete-csv" class="hidden">

          <!-- Step 1: Upload -->
          <div class="panel" id="notes-delete-csv-step-upload">
            <div class="panel-header">
              <div class="panel-title">Delete notes from CSV</div>
              <div class="panel-subtitle">Upload a CSV containing PB Note IDs and permanently delete those notes.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div class="alert alert-warn mb-16">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span>This action is <strong>irreversible</strong>. Deleted notes cannot be recovered. You can use the export CSV directly ‚Äî just select the <em>PB Note ID</em> column.</span>
              </div>
              <div class="dropzone" id="notes-delete-dropzone">
                <span class="dropzone-icon">üìÑ</span>
                <div class="dropzone-label">Drop a CSV file here</div>
                <div class="dropzone-hint">or click to browse</div>
              </div>
              <input type="file" id="notes-delete-file-input" accept=".csv,text/csv" class="hidden" />
            </div>
          </div>

          <!-- Step 2: Column picker + confirm -->
          <div class="panel mt-16 hidden" id="notes-delete-csv-step-confirm">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div>
                  <div class="panel-title">Confirm deletion</div>
                  <div class="panel-subtitle" id="notes-delete-csv-subtitle"></div>
                </div>
                <button class="btn btn-ghost btn-sm" id="btn-notes-delete-reupload">‚Ü© Re-upload</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div class="mb-16">
                <label>Which column contains the PB Note UUIDs?</label>
                <select id="notes-delete-uuid-column" class="mt-8" style="width:100%;max-width:320px;padding:6px 8px;border:1px solid var(--c-border);border-radius:6px;font-size:14px"></select>
              </div>
              <div id="notes-delete-csv-preview" class="mb-16 text-sm text-muted font-mono hidden"></div>
              <button class="btn btn-danger" id="btn-notes-delete-csv-run">üóë Delete notes</button>
            </div>
          </div>

          <!-- Step 3: Progress + log -->
          <div class="panel mt-16 hidden" id="notes-delete-csv-step-run">
            <div class="panel-header">
              <div class="flex items-center justify-between">
                <div class="panel-title" id="notes-delete-csv-run-title">Deleting notes‚Ä¶</div>
                <button class="btn btn-danger btn-sm hidden" id="btn-stop-notes-delete-csv">‚èπ Stop</button>
              </div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">
              <div id="notes-delete-csv-running">
                <div class="progress-wrap">
                  <div class="progress-bar" id="notes-delete-csv-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="notes-delete-csv-progress-msg">Starting‚Ä¶</span>
                  <span id="notes-delete-csv-progress-pct">0%</span>
                </div>
                <div id="notes-delete-csv-live-log" class="live-log hidden mt-16">
                  <div class="live-log-header"><span>Live log</span></div>
                  <div id="notes-delete-csv-log-entries" class="live-log-scroll"></div>
                </div>
              </div>
              <div id="notes-delete-csv-results" class="hidden">
                <div id="notes-delete-csv-summary-alert"></div>
                <button class="btn btn-secondary mt-16" id="btn-notes-delete-csv-again">‚Üê Delete more</button>
              </div>
            </div>
          </div>

        </div><!-- /view-notes-delete-csv -->

        <!-- ‚îÄ‚îÄ NOTES DELETE ALL ‚îÄ‚îÄ -->
        <div id="view-notes-delete-all" class="hidden">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Delete all notes</div>
              <div class="panel-subtitle">Permanently delete every note in your Productboard workspace.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div id="notes-delete-all-idle">
                <div class="alert alert-danger mb-16">
                  <span class="alert-icon">‚õî</span>
                  <span><strong>This will permanently delete every note in your workspace.</strong> This action cannot be undone and there is no way to recover deleted notes. Use with extreme caution ‚Äî ideally export first.</span>
                </div>
                <p class="text-sm text-muted mb-16">Type <strong>DELETE</strong> in the box below to enable the button.</p>
                <input type="text" id="notes-delete-all-confirm-input" placeholder="Type DELETE to confirm" autocomplete="off"
                  style="display:block;width:100%;max-width:320px;padding:8px 10px;border:1px solid var(--c-border);border-radius:6px;font-size:14px;margin-bottom:12px" />
                <button class="btn btn-danger" id="btn-notes-delete-all-run" disabled>‚õî Delete all notes</button>
              </div>

              <div id="notes-delete-all-running" class="hidden">
                <div class="progress-wrap">
                  <div class="progress-bar" id="notes-delete-all-progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-label">
                  <span id="notes-delete-all-progress-msg">Starting‚Ä¶</span>
                  <span id="notes-delete-all-progress-pct">0%</span>
                </div>
                <div id="notes-delete-all-live-log" class="live-log hidden mt-16">
                  <div class="live-log-header"><span>Live log</span></div>
                  <div id="notes-delete-all-log-entries" class="live-log-scroll"></div>
                </div>
              </div>

              <div id="notes-delete-all-results" class="hidden">
                <div id="notes-delete-all-summary-alert"></div>
                <button class="btn btn-secondary mt-16" id="btn-notes-delete-all-again">‚Üê Start over</button>
              </div>

            </div>
          </div>
        </div><!-- /view-notes-delete-all -->

        <!-- ‚îÄ‚îÄ NOTES MIGRATION PREP ‚îÄ‚îÄ -->
        <div id="view-notes-migrate" class="hidden">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Migration prep</div>
              <div class="panel-subtitle">Transform an export CSV to make notes ready for import into a new workspace.</div>
            </div>
            <hr class="panel-divider mt-12" />
            <div class="panel-body">

              <div class="alert alert-info mb-16">
                <span class="alert-icon">‚ÑπÔ∏è</span>
                <span>
                  <strong>Workflow:</strong>
                  <ol style="margin:6px 0 0 16px;padding:0;line-height:1.7">
                    <li>Export notes from your source workspace (Export notes tab).</li>
                    <li>Upload that CSV here and enter the migration source name.</li>
                    <li>Download the transformed CSV ‚Äî each note's <em>pb_id</em> is moved to <em>source_record_id</em> (so it can be deduplicated on re-import), <em>source_origin</em> is set to your source name, and <em>pb_id</em> is cleared so Productboard creates a fresh note in the target workspace.</li>
                    <li>Import the transformed CSV into the target workspace (Import notes tab). Enable <em>Migration mode</em> to also remap linked entity UUIDs.</li>
                  </ol>
                </span>
              </div>

              <div id="notes-migrate-idle">
                <div class="dropzone" id="notes-migrate-dropzone">
                  <span class="dropzone-icon">üìÑ</span>
                  <div class="dropzone-label">Drop your export CSV here</div>
                  <div class="dropzone-hint">or click to browse</div>
                </div>
                <input type="file" id="notes-migrate-file-input" accept=".csv,text/csv" class="hidden" />

                <div class="hidden mt-16" id="notes-migrate-form">
                  <label>Migration source name <span class="label-hint">‚Äî used as source_origin value</span></label>
                  <input type="text" id="notes-migrate-source-name" placeholder="e.g. workspace-v1"
                    style="display:block;width:100%;max-width:320px;padding:8px 10px;border:1px solid var(--c-border);border-radius:6px;font-size:14px;margin-top:6px" />
                  <p class="text-sm text-muted mt-8">Example: if you enter <code>acme-source</code>, the original pb_id is written to source_record_id and source_origin is set to <code>acme-source</code>. Any pre-existing source_record_id on the note is replaced.</p>
                  <button class="btn btn-primary mt-12" id="btn-notes-migrate-run">üîÑ Prepare CSV</button>
                </div>
              </div>

              <div id="notes-migrate-done" class="hidden">
                <div class="alert alert-ok">
                  <span class="alert-icon">‚úÖ</span>
                  <span id="notes-migrate-done-msg"></span>
                </div>
                <button class="btn btn-primary mt-16" id="btn-notes-migrate-download">‚¨áÔ∏è Download prepared CSV</button>
                <button class="btn btn-secondary mt-8" id="btn-notes-migrate-again">‚Üê Prepare another</button>
              </div>

              <div id="notes-migrate-error" class="hidden">
                <div class="alert alert-danger">
                  <span class="alert-icon">‚ö†Ô∏è</span>
                  <span id="notes-migrate-error-msg"></span>
                </div>
                <button class="btn btn-secondary mt-8" id="btn-notes-migrate-retry">Try again</button>
              </div>

            </div>
          </div>
        </div><!-- /view-notes-migrate -->

      </div><!-- /view-area -->
    </div><!-- /main-content -->
  </div><!-- /tool-view -->

</div><!-- /app-screen -->

<script src="app.js"></script>
</body>
</html>
